<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pg基础 | think-build-share</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/vuepress/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/MouseClickEffect.js"></script>
    <meta name="description" content="Just playing around">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.4603f7b5.css" as="style"><link rel="preload" href="/assets/js/app.198c1c7f.js" as="script"><link rel="preload" href="/assets/js/3.e89c7bc2.js" as="script"><link rel="preload" href="/assets/js/1.f801d562.js" as="script"><link rel="preload" href="/assets/js/29.24d6fb71.js" as="script"><link rel="prefetch" href="/assets/js/10.9e9a9a99.js"><link rel="prefetch" href="/assets/js/11.3ed6a9a8.js"><link rel="prefetch" href="/assets/js/12.1bec8c85.js"><link rel="prefetch" href="/assets/js/13.265db576.js"><link rel="prefetch" href="/assets/js/14.97e09b0a.js"><link rel="prefetch" href="/assets/js/15.2ec2469c.js"><link rel="prefetch" href="/assets/js/16.788c4eb5.js"><link rel="prefetch" href="/assets/js/17.3ba649a8.js"><link rel="prefetch" href="/assets/js/18.7dd75726.js"><link rel="prefetch" href="/assets/js/19.1aebbbde.js"><link rel="prefetch" href="/assets/js/20.dd8d4020.js"><link rel="prefetch" href="/assets/js/21.e249a984.js"><link rel="prefetch" href="/assets/js/22.4d68d91d.js"><link rel="prefetch" href="/assets/js/23.4ad45b35.js"><link rel="prefetch" href="/assets/js/24.be0c09ac.js"><link rel="prefetch" href="/assets/js/25.97582c89.js"><link rel="prefetch" href="/assets/js/26.777f93a1.js"><link rel="prefetch" href="/assets/js/27.b16f6d8c.js"><link rel="prefetch" href="/assets/js/28.ea08c8e9.js"><link rel="prefetch" href="/assets/js/30.8510435b.js"><link rel="prefetch" href="/assets/js/31.6253aec9.js"><link rel="prefetch" href="/assets/js/32.0dd560a4.js"><link rel="prefetch" href="/assets/js/33.65361602.js"><link rel="prefetch" href="/assets/js/34.f27436cb.js"><link rel="prefetch" href="/assets/js/35.7ac29299.js"><link rel="prefetch" href="/assets/js/36.1925b76e.js"><link rel="prefetch" href="/assets/js/37.66334c26.js"><link rel="prefetch" href="/assets/js/38.ad378120.js"><link rel="prefetch" href="/assets/js/39.b8c80c17.js"><link rel="prefetch" href="/assets/js/4.6d2297c8.js"><link rel="prefetch" href="/assets/js/40.6e9acd1c.js"><link rel="prefetch" href="/assets/js/41.4c0dde9e.js"><link rel="prefetch" href="/assets/js/42.136aac0d.js"><link rel="prefetch" href="/assets/js/43.2ed33d60.js"><link rel="prefetch" href="/assets/js/44.5f0958a7.js"><link rel="prefetch" href="/assets/js/45.d8af4376.js"><link rel="prefetch" href="/assets/js/46.47414fa6.js"><link rel="prefetch" href="/assets/js/47.236a103d.js"><link rel="prefetch" href="/assets/js/48.eb854a20.js"><link rel="prefetch" href="/assets/js/49.d105ebf1.js"><link rel="prefetch" href="/assets/js/5.0bad958f.js"><link rel="prefetch" href="/assets/js/50.81578e80.js"><link rel="prefetch" href="/assets/js/51.50020fb7.js"><link rel="prefetch" href="/assets/js/52.ba1978dc.js"><link rel="prefetch" href="/assets/js/53.14cf8caf.js"><link rel="prefetch" href="/assets/js/54.50dcb08c.js"><link rel="prefetch" href="/assets/js/55.57c793c6.js"><link rel="prefetch" href="/assets/js/56.42aef2b5.js"><link rel="prefetch" href="/assets/js/57.d191e17d.js"><link rel="prefetch" href="/assets/js/58.cf46b1f1.js"><link rel="prefetch" href="/assets/js/59.2b663f38.js"><link rel="prefetch" href="/assets/js/6.fa56699c.js"><link rel="prefetch" href="/assets/js/60.e3407b1e.js"><link rel="prefetch" href="/assets/js/61.8f658a38.js"><link rel="prefetch" href="/assets/js/62.49cc39d7.js"><link rel="prefetch" href="/assets/js/63.312918bd.js"><link rel="prefetch" href="/assets/js/64.ad64e103.js"><link rel="prefetch" href="/assets/js/65.16e8c687.js"><link rel="prefetch" href="/assets/js/66.39969a99.js"><link rel="prefetch" href="/assets/js/67.c6bf4b85.js"><link rel="prefetch" href="/assets/js/68.a9569d5e.js"><link rel="prefetch" href="/assets/js/69.07dee552.js"><link rel="prefetch" href="/assets/js/7.e29bd960.js"><link rel="prefetch" href="/assets/js/70.6eb5c190.js"><link rel="prefetch" href="/assets/js/71.d9eeb169.js"><link rel="prefetch" href="/assets/js/72.4bd38647.js"><link rel="prefetch" href="/assets/js/73.4894419e.js"><link rel="prefetch" href="/assets/js/74.7ca0518b.js"><link rel="prefetch" href="/assets/js/75.992062db.js"><link rel="prefetch" href="/assets/js/76.0d4a6fb8.js"><link rel="prefetch" href="/assets/js/77.0e400fc3.js"><link rel="prefetch" href="/assets/js/78.856242bd.js"><link rel="prefetch" href="/assets/js/79.f33266da.js"><link rel="prefetch" href="/assets/js/8.530ccac1.js"><link rel="prefetch" href="/assets/js/80.c6e7e3b5.js"><link rel="prefetch" href="/assets/js/81.0076c66b.js"><link rel="prefetch" href="/assets/js/82.c3e5e4fb.js"><link rel="prefetch" href="/assets/js/83.fc52047e.js"><link rel="prefetch" href="/assets/js/84.f87af67f.js"><link rel="prefetch" href="/assets/js/85.cf37baf7.js"><link rel="prefetch" href="/assets/js/86.237cd68c.js"><link rel="prefetch" href="/assets/js/87.89e5e27f.js"><link rel="prefetch" href="/assets/js/88.fb79632a.js"><link rel="prefetch" href="/assets/js/9.827f66a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4603f7b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-9f1e2f90><div data-v-9f1e2f90><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-9f1e2f90 data-v-9f1e2f90><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76>think-build-share</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>think-build-share</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-9f1e2f90><header class="navbar" data-v-9f1e2f90><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">think-build-share</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask" data-v-9f1e2f90></div> <aside class="sidebar" data-v-9f1e2f90><div class="personal-info-wrapper" data-v-3eba7259 data-v-9f1e2f90><!----> <h3 class="name" data-v-3eba7259>
    think-build-share
  </h3> <div class="num" data-v-3eba7259><div data-v-3eba7259><h3 data-v-3eba7259>1</h3> <h6 data-v-3eba7259>Article</h6></div> <div data-v-3eba7259><h3 data-v-3eba7259>1</h3> <h6 data-v-3eba7259>Tag</h6></div></div> <hr data-v-3eba7259></div> <!----> <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三省吾身</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>万丈高楼平地起</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring Boot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/" class="sidebar-link">mysql</a></li><li><a href="/database/pg_base.html" aria-current="page" class="active sidebar-link">pg基础</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>字符集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>团队与实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C(++)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>think-build-share</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-9f1e2f90><main class="page"><div class="page-title" style="display:none;"><h1 class="title">pg基础</h1> <div data-v-42458482><i class="iconfont reco-account" data-v-42458482><span data-v-42458482>think-build-share</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="pg基础"><a href="#pg基础" class="header-anchor">#</a> pg基础</h2> <h3 id="安装postgres"><a href="#安装postgres" class="header-anchor">#</a> 安装postgres</h3> <ul><li>windows10 64bit安装</li></ul> <h3 id="重点掌握db-用户-角色-schema-权限-模型"><a href="#重点掌握db-用户-角色-schema-权限-模型" class="header-anchor">#</a> 重点掌握DB/用户（角色）/Schema/权限/模型</h3> <p>1db -&gt; n用户
1db -&gt; n schema
1用户 -&gt; n schema
1用户 -&gt; n 权限
1 schema -&gt; n db objects</p> <h3 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h3> <h4 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h4> <p>打开SQL Shell</p> <ul><li>创建数据库<br>
create database play_ground;</li> <li>查看数据库<br>
\l</li> <li>进入数据库<br>
\c play_ground</li> <li>删除数据库（需要注意如果有其他会话使用当前数据库，则当前数据库无法删除）<br>
drop database play_ground;</li></ul> <h4 id="user-and-role"><a href="#user-and-role" class="header-anchor">#</a> User and Role</h4> <p>create user是create role的别名。区别在与create user默认Login。而create role默认NOLOGIN</p> <ul><li>创建一个带密码的角色（create user等价create role还暗示了可登录）
create user hxchen with password 'h123';</li></ul> <h4 id="权限"><a href="#权限" class="header-anchor">#</a> 权限</h4> <ul><li>分类
INSERT/DELETE/TRUNCATE/UPDATE/SELECT
CREATE/REFERENCES/TRIGGER/CONNECT/TEMPORARY/EXECUTE/USAGE</li> <li>将play_ground数据库的所有权限授予hxchen角色（用户）
grant all on database play_ground to hxchen;</li> <li>将public schema里的所有表的权限授予hxchen用户（角色）
<ul><li>grant all on all tables in schema public to hxchen with grant option</li> <li>with grant option指定了hxchen也具有grant的响应权限</li></ul></li></ul> <h4 id="schema"><a href="#schema" class="header-anchor">#</a> schema</h4> <ul><li>public schema
默认情况创建的对象存放在public schema中。</li> <li>创建schema
<ul><li>pg_开头的名称为保留字</li> <li>为用户hxchen创建名为hxchen的schema
create schema authorization hxchen;</li> <li>为用户hxchen创建名为teacher的schema（如果不存在的话）
create schema if not exists teacher authorization hxchen</li></ul></li> <li>删除schema
drop schema student</li> <li>schema搜索路径
使用create schema_name.table_name的方式来在某个schema下创建表也是可以的。但是这不是最佳实践，通常也不建议将实际的schema
写入应用，主要考虑可移植的问题。
<ul><li>show search_path
<ul><li>&quot;$user&quot;, public 首先在和当前用户同名的schema中查找，查找不到在public中查找</li> <li>search_path中第一个schema称为current schema，是查找和创建表（未指定schema）所在的schema</li> <li>如果我们没创建任何schema，那么默认的是public schema，这也默认情况对象创建在public schema的原因。</li> <li>通过<code>set search_path to hxchen</code>设置查找和创建对象的schema为hxchen，这样public schema就不会被搜索（除非指定了public.tableName）</li> <li>select current_schema 返回search_path中第一个schema。</li></ul></li></ul></li></ul> <h4 id="表"><a href="#表" class="header-anchor">#</a> 表</h4> <ul><li><p>创建表<br>
create table t_student(
id int,
ch_name varchar(20),
student_no int,
sex char(1),
primary key(id)
);</p></li> <li><p>删除表<br>
drop table t_student;</p></li> <li><p>修改表</p> <ul><li>增加表字段<br>
alter table t_student add column age int;
alter table t_student add column insert_time timestamp;</li> <li>删除表字段<br>
alter table t_student drop column age;</li> <li>修改表字段类型、长度<br>
alter table t_student alter column student_no type varchar(3);</li> <li>修改字段，增加默认值<br>
alter table t_student alter column insert_time set default current_timestamp;</li> <li>修改字段，删除默认值<br>
alter table t_student alter column insert_time drop default;</li> <li>字段重命名
alter table t_student rename column student_no to student_number;</li></ul></li> <li><p>重命名表
alter table t_student rename to t_student_base</p></li> <li><p>插入语句<br>
INSERT INTO t_student
(id, ch_name, student_no, sex, age, insert_time)
VALUES(1, '祥', '1', '1', 32, CURRENT_TIMESTAMP);</p></li> <li><p>更新语句<br>
update t_student set ch_name = '海祥' where id = 1;</p></li> <li><p>删除语句<br>
delete from t_student where id = 1;</p></li></ul> <h4 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h4> <ul><li>创建索引<br>
create index ch_name_idx on t_student(ch_name);</li> <li>删除索引
drop index ch_name_idx;</li></ul> <h4 id="约束"><a href="#约束" class="header-anchor">#</a> 约束</h4> <ul><li>添加约束
<ul><li>添加唯一约束
<ul><li>alter table t_student add constraint ch_name_uk unique(ch_name);</li> <li>添加了ch_name唯一约束后，插入相同的ch_name，提示键值已存在</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- SQL 错误 [23505]: 错误: 重复键违反唯一约束&quot;ch_name_uk&quot;</span>
<span class="token comment">-- Detail: 键值&quot;(ch_name)=(祥)&quot; 已经存在</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_student
<span class="token punctuation">(</span>id<span class="token punctuation">,</span> ch_name<span class="token punctuation">,</span> student_no<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">,</span> insert_time<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'祥'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>添加检查约束
alter table t_student add check(age &gt; 0)</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 关系 &quot;t_student&quot; 的新列违反了检查约束 &quot;t_student_age_check&quot;</span>
<span class="token comment">-- Detail: 失败, 行包含(3, 陈, 2, 1, 0, 2021-01-25 09:09:55.864822).</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_student
<span class="token punctuation">(</span>id<span class="token punctuation">,</span> ch_name<span class="token punctuation">,</span> student_no<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">,</span> insert_time<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'陈'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>添加非null约束
alter table t_student alter column ch_name set not null</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 在字段 &quot;ch_name&quot; 中空值违反了非空约束</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_student
<span class="token punctuation">(</span>id<span class="token punctuation">,</span> ch_name<span class="token punctuation">,</span> student_no<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">,</span> insert_time<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>删除约束
<ul><li>sql shell中使用\d t_student 查找t_student表定义详情（字段，约束，索引）</li> <li>删除not null以外的约束
alter table t_student drop constraint ch_name_uk</li> <li>删除not null 约束
alter table t_student alter column ch_name drop not null</li></ul></li></ul> <h4 id="表连接"><a href="#表连接" class="header-anchor">#</a> 表连接</h4> <ul><li>创建3张表用于演示不同的连接类型</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_student<span class="token punctuation">(</span>
	id <span class="token keyword">int</span><span class="token punctuation">,</span>
	ch_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	student_no <span class="token keyword">int</span><span class="token punctuation">,</span>
	sex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> t_course<span class="token punctuation">(</span>
id <span class="token keyword">int</span><span class="token punctuation">,</span>
course_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> t_student_coursr<span class="token punctuation">(</span>
	student_id <span class="token keyword">int</span><span class="token punctuation">,</span>
	course_id <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 初始化演示数据 </span>
<span class="token comment">-- 2个学生a, b</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_student
<span class="token punctuation">(</span>id<span class="token punctuation">,</span> ch_name<span class="token punctuation">,</span> student_no<span class="token punctuation">,</span> sex<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 2门课程english,math</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_course
<span class="token punctuation">(</span>id<span class="token punctuation">,</span> course_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'english'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--a选了english， b选了math</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_student_coursr
<span class="token punctuation">(</span>student_id<span class="token punctuation">,</span> course_id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>cross join （M * N 行记录）对于第一个表(M行)的每一行记录，第二个表的每一行（N行）都与之匹配</p> <ul><li><code>select * from t_student s cross join t_course c</code></li> <li>本例中 2 * 2 = 4 条记录</li> <li>等同于<code>select * from t_student, t_course tc</code> <ul><li>注意多个两个表的连接并不等同于逗号隔开的形式如下两种写法不等效
<ul><li>select * from t_student s, t_course c inner join t_student_coursr sc on s.id  = sc.student_id</li> <li>select * from t_student s cross join t_course c inner join t_student_coursr sc on s.id  = sc.student_id</li> <li>第一条查询语句s和c表用逗号隔开,因此on后面的引用s里的字段是非法的。而第二条语句join的方式是可以访问s表字段的。</li></ul></li></ul></li> <li>等同于<code>select * from t_student inner join t_course on true</code></li></ul></li> <li><p>限制的join</p> <ul><li>外连接（outer）join
<ul><li>left  (outer) join列出左侧表的所有行记录（右侧表不匹配的行被筛选出的列值以null返回）
select * from t_student s left join t_student_coursr sc on s.id = sc.student_id and sc.course_id = 3</li> <li>right (outer) join列出右侧表的所有行记录（左侧表不匹配的行被筛选出的列值以null返回）
select * from t_student s right join t_student_coursr sc on s.id = sc.student_id and s.id = 3</li> <li>full  (outer) join列出两个表的所有行记录（不管左侧表还是右侧表不匹配的行返回的列值以null返回）
select * from t_student s full join t_student_coursr sc on s.id = sc.student_id and s.id = 3 and sc.course_id = 3</li></ul></li> <li>内连接（inner）join 返回2个表都满足匹配条件的行记录
select * from t_student s join t_student_coursr  sc on s.id  = sc.student_id</li></ul></li></ul> <h4 id="综合查询"><a href="#综合查询" class="header-anchor">#</a> 综合查询</h4> <p>不带all的，结果行会去重</p> <ul><li>union/union all 查询结果做并集
select * from t_student s1
union all
select * from t_student s2</li> <li>intersect/intersect all 查询结果做交集
select * from t_student s1
intersect
select * from t_student s2</li> <li>except/except all 查询结果做差集，s1 - s2
select * from t_student s1 where id = 1
except
select * from t_student s2 where id = 2</li></ul> <h4 id="关于null-not-null"><a href="#关于null-not-null" class="header-anchor">#</a> 关于NULL，NOT NULL</h4> <p>NULL值不是空的意思，理解为不确定的值。打个比方，女生不告诉你年龄，不代表年龄是0，我们表示这种不确定就用NULL。</p> <ul><li>NOT NULL在建表时用在列上表示列NOT NULL约束，表示在插入数据时，该列必须提供值<div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_student<span class="token punctuation">(</span>
	id <span class="token keyword">int</span><span class="token punctuation">,</span>
	ch_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	hobby <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	student_no <span class="token keyword">int</span><span class="token punctuation">,</span>
	sex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如上ch_name定义为not null，表示插入数据时ch_name必须提供值</li> <li>如上hobby定义为null，这不意味着必须是null值，表示可以为null，如果不提供值，默认为null，另外这不是sql标准定义的。</li> <li>对于表中重要字段，我们一般要定义为not null，对于可为null的字段，我们一般不需要显式定义为null，上面仅是一个示例。</li> <li>在pg中显式使用not null约束要比使用check约束高效。</li></ul></li> <li>关于NULL的查询，条件使用is null，is not null，千万不能用=null
select * from t_student ts where hobby  is null
select * from t_student ts where hobby  is not null</li></ul> <h4 id="分区使用"><a href="#分区使用" class="header-anchor">#</a> 分区使用</h4> <p>-- 分区测试
CREATE TABLE customers (id INTEGER, status TEXT, arr NUMERIC) PARTITION BY LIST(status);
-- 定义分区表名，及分区条件</p> <p>-- List 分区
CREATE TABLE cust_active PARTITION OF customers FOR VALUES IN ('ACTIVE');
CREATE TABLE cust_archived PARTITION OF customers FOR VALUES IN ('EXPIRED');
CREATE TABLE cust_others PARTITION OF customers DEFAULT;</p> <p>\d+ customers
\d+ cust_active</p> <p>select * from cust_active
select * from cust_archived
select * from cust_others
select * from customers
INSERT INTO customers VALUES (1,'ACTIVE',100), (2,'RECURRING',20), (3,'EXPIRED',38), (4,'REACTIVATED',144);</p> <p>SELECT tableoid::regclass,* FROM customers;</p> <p>-- 解绑分区
ALTER TABLE customers DETACH PARTITION cust_active;</p> <p>-- 绑定分区
ALTER TABLE customers ATTACH PARTITION cust_active FOR VALUES IN ('ACTIVE');</p> <p>select * from cust_active</p> <p>-- RANGE 分区
CREATE TABLE cust_arr_small PARTITION OF customers FOR VALUES FROM (MINVALUE) TO (25);</p> <p>CREATE TABLE customers_new ( like customers including all ) PARTITION BY RANGE(arr);
CREATE TABLE cust_arr_small PARTITION OF customers_new FOR VALUES FROM (MINVALUE) TO (25);
CREATE TABLE cust_arr_medium PARTITION OF customers_new FOR VALUES FROM (25) TO (75);
CREATE TABLE cust_arr_large PARTITION OF customers_new FOR VALUES FROM (75) TO (MAXVALUE);
insert into customers_new
select * from customers</p> <p>alter table customers rename to customers_old
alter table customers_new rename to customers</p> <p>select * from customers
select * from cust_arr_small
select * from cust_arr_medium
select * from cust_arr_large</p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.198c1c7f.js" defer></script><script src="/assets/js/3.e89c7bc2.js" defer></script><script src="/assets/js/1.f801d562.js" defer></script><script src="/assets/js/29.24d6fb71.js" defer></script>
  </body>
</html>
