(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{558:function(t,s,n){"use strict";n.r(s);var a=n(4),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"pg基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pg基础"}},[t._v("#")]),t._v(" pg基础")]),t._v(" "),n("h3",{attrs:{id:"安装postgres"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装postgres"}},[t._v("#")]),t._v(" 安装postgres")]),t._v(" "),n("ul",[n("li",[t._v("windows10 64bit安装")])]),t._v(" "),n("h3",{attrs:{id:"重点掌握db-用户-角色-schema-权限-模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重点掌握db-用户-角色-schema-权限-模型"}},[t._v("#")]),t._v(" 重点掌握DB/用户（角色）/Schema/权限/模型")]),t._v(" "),n("p",[t._v("1db -> n用户\n1db -> n schema\n1用户 -> n schema\n1用户 -> n 权限\n1 schema -> n db objects")]),t._v(" "),n("h3",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),n("h4",{attrs:{id:"数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[t._v("#")]),t._v(" 数据库")]),t._v(" "),n("p",[t._v("打开SQL Shell")]),t._v(" "),n("ul",[n("li",[t._v("创建数据库"),n("br"),t._v("\ncreate database play_ground;")]),t._v(" "),n("li",[t._v("查看数据库"),n("br"),t._v("\n\\l")]),t._v(" "),n("li",[t._v("进入数据库"),n("br"),t._v("\n\\c play_ground")]),t._v(" "),n("li",[t._v("删除数据库（需要注意如果有其他会话使用当前数据库，则当前数据库无法删除）"),n("br"),t._v("\ndrop database play_ground;")])]),t._v(" "),n("h4",{attrs:{id:"user-and-role"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user-and-role"}},[t._v("#")]),t._v(" User and Role")]),t._v(" "),n("p",[t._v("create user是create role的别名。区别在与create user默认Login。而create role默认NOLOGIN")]),t._v(" "),n("ul",[n("li",[t._v("创建一个带密码的角色（create user等价create role还暗示了可登录）\ncreate user hxchen with password 'h123';")])]),t._v(" "),n("h4",{attrs:{id:"权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#权限"}},[t._v("#")]),t._v(" 权限")]),t._v(" "),n("ul",[n("li",[t._v("分类\nINSERT/DELETE/TRUNCATE/UPDATE/SELECT\nCREATE/REFERENCES/TRIGGER/CONNECT/TEMPORARY/EXECUTE/USAGE")]),t._v(" "),n("li",[t._v("将play_ground数据库的所有权限授予hxchen角色（用户）\ngrant all on database play_ground to hxchen;")]),t._v(" "),n("li",[t._v("将public schema里的所有表的权限授予hxchen用户（角色）\n"),n("ul",[n("li",[t._v("grant all on all tables in schema public to hxchen with grant option")]),t._v(" "),n("li",[t._v("with grant option指定了hxchen也具有grant的响应权限")])])])]),t._v(" "),n("h4",{attrs:{id:"schema"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#schema"}},[t._v("#")]),t._v(" schema")]),t._v(" "),n("ul",[n("li",[t._v("public schema\n默认情况创建的对象存放在public schema中。")]),t._v(" "),n("li",[t._v("创建schema\n"),n("ul",[n("li",[t._v("pg_开头的名称为保留字")]),t._v(" "),n("li",[t._v("为用户hxchen创建名为hxchen的schema\ncreate schema authorization hxchen;")]),t._v(" "),n("li",[t._v("为用户hxchen创建名为teacher的schema（如果不存在的话）\ncreate schema if not exists teacher authorization hxchen")])])]),t._v(" "),n("li",[t._v("删除schema\ndrop schema student")]),t._v(" "),n("li",[t._v("schema搜索路径\n使用create schema_name.table_name的方式来在某个schema下创建表也是可以的。但是这不是最佳实践，通常也不建议将实际的schema\n写入应用，主要考虑可移植的问题。\n"),n("ul",[n("li",[t._v("show search_path\n"),n("ul",[n("li",[t._v('"$user", public 首先在和当前用户同名的schema中查找，查找不到在public中查找')]),t._v(" "),n("li",[t._v("search_path中第一个schema称为current schema，是查找和创建表（未指定schema）所在的schema")]),t._v(" "),n("li",[t._v("如果我们没创建任何schema，那么默认的是public schema，这也默认情况对象创建在public schema的原因。")]),t._v(" "),n("li",[t._v("通过"),n("code",[t._v("set search_path to hxchen")]),t._v("设置查找和创建对象的schema为hxchen，这样public schema就不会被搜索（除非指定了public.tableName）")]),t._v(" "),n("li",[t._v("select current_schema 返回search_path中第一个schema。")])])])])])]),t._v(" "),n("h4",{attrs:{id:"表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表"}},[t._v("#")]),t._v(" 表")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("创建表"),n("br"),t._v("\ncreate table t_student(\nid int,\nch_name varchar(20),\nstudent_no int,\nsex char(1),\nprimary key(id)\n);")])]),t._v(" "),n("li",[n("p",[t._v("删除表"),n("br"),t._v("\ndrop table t_student;")])]),t._v(" "),n("li",[n("p",[t._v("修改表")]),t._v(" "),n("ul",[n("li",[t._v("增加表字段"),n("br"),t._v("\nalter table t_student add column age int;\nalter table t_student add column insert_time timestamp;")]),t._v(" "),n("li",[t._v("删除表字段"),n("br"),t._v("\nalter table t_student drop column age;")]),t._v(" "),n("li",[t._v("修改表字段类型、长度"),n("br"),t._v("\nalter table t_student alter column student_no type varchar(3);")]),t._v(" "),n("li",[t._v("修改字段，增加默认值"),n("br"),t._v("\nalter table t_student alter column insert_time set default current_timestamp;")]),t._v(" "),n("li",[t._v("修改字段，删除默认值"),n("br"),t._v("\nalter table t_student alter column insert_time drop default;")]),t._v(" "),n("li",[t._v("字段重命名\nalter table t_student rename column student_no to student_number;")])])]),t._v(" "),n("li",[n("p",[t._v("重命名表\nalter table t_student rename to t_student_base")])]),t._v(" "),n("li",[n("p",[t._v("插入语句"),n("br"),t._v("\nINSERT INTO t_student\n(id, ch_name, student_no, sex, age, insert_time)\nVALUES(1, '祥', '1', '1', 32, CURRENT_TIMESTAMP);")])]),t._v(" "),n("li",[n("p",[t._v("更新语句"),n("br"),t._v("\nupdate t_student set ch_name = '海祥' where id = 1;")])]),t._v(" "),n("li",[n("p",[t._v("删除语句"),n("br"),t._v("\ndelete from t_student where id = 1;")])])]),t._v(" "),n("h4",{attrs:{id:"索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),n("ul",[n("li",[t._v("创建索引"),n("br"),t._v("\ncreate index ch_name_idx on t_student(ch_name);")]),t._v(" "),n("li",[t._v("删除索引\ndrop index ch_name_idx;")])]),t._v(" "),n("h4",{attrs:{id:"约束"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#约束"}},[t._v("#")]),t._v(" 约束")]),t._v(" "),n("ul",[n("li",[t._v("添加约束\n"),n("ul",[n("li",[t._v("添加唯一约束\n"),n("ul",[n("li",[t._v("alter table t_student add constraint ch_name_uk unique(ch_name);")]),t._v(" "),n("li",[t._v("添加了ch_name唯一约束后，插入相同的ch_name，提示键值已存在")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('-- SQL 错误 [23505]: 错误: 重复键违反唯一约束"ch_name_uk"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('-- Detail: 键值"(ch_name)=(祥)" 已经存在')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_student\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" student_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insert_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'祥'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("添加检查约束\nalter table t_student add check(age > 0)")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('-- 关系 "t_student" 的新列违反了检查约束 "t_student_age_check"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- Detail: 失败, 行包含(3, 陈, 2, 1, 0, 2021-01-25 09:09:55.864822).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_student\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" student_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insert_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'陈'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("添加非null约束\nalter table t_student alter column ch_name set not null")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('-- 在字段 "ch_name" 中空值违反了非空约束')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_student\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" student_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insert_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("删除约束\n"),n("ul",[n("li",[t._v("sql shell中使用\\d t_student 查找t_student表定义详情（字段，约束，索引）")]),t._v(" "),n("li",[t._v("删除not null以外的约束\nalter table t_student drop constraint ch_name_uk")]),t._v(" "),n("li",[t._v("删除not null 约束\nalter table t_student alter column ch_name drop not null")])])])]),t._v(" "),n("h4",{attrs:{id:"表连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表连接"}},[t._v("#")]),t._v(" 表连接")]),t._v(" "),n("ul",[n("li",[t._v("创建3张表用于演示不同的连接类型")])]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" t_student"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tch_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tstudent_no "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tsex "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" t_course"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncourse_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" t_student_coursr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tstudent_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tcourse_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 初始化演示数据 ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 2个学生a, b")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_student\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" student_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 2门课程english,math")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_course\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" course_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'english'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'math'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--a选了english， b选了math")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" t_student_coursr\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("student_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" course_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("ul",[n("li",[n("p",[t._v("cross join （M * N 行记录）对于第一个表(M行)的每一行记录，第二个表的每一行（N行）都与之匹配")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("select * from t_student s cross join t_course c")])]),t._v(" "),n("li",[t._v("本例中 2 * 2 = 4 条记录")]),t._v(" "),n("li",[t._v("等同于"),n("code",[t._v("select * from t_student, t_course tc")]),t._v(" "),n("ul",[n("li",[t._v("注意多个两个表的连接并不等同于逗号隔开的形式如下两种写法不等效\n"),n("ul",[n("li",[t._v("select * from t_student s, t_course c inner join t_student_coursr sc on s.id  = sc.student_id")]),t._v(" "),n("li",[t._v("select * from t_student s cross join t_course c inner join t_student_coursr sc on s.id  = sc.student_id")]),t._v(" "),n("li",[t._v("第一条查询语句s和c表用逗号隔开,因此on后面的引用s里的字段是非法的。而第二条语句join的方式是可以访问s表字段的。")])])])])]),t._v(" "),n("li",[t._v("等同于"),n("code",[t._v("select * from t_student inner join t_course on true")])])])]),t._v(" "),n("li",[n("p",[t._v("限制的join")]),t._v(" "),n("ul",[n("li",[t._v("外连接（outer）join\n"),n("ul",[n("li",[t._v("left  (outer) join列出左侧表的所有行记录（右侧表不匹配的行被筛选出的列值以null返回）\nselect * from t_student s left join t_student_coursr sc on s.id = sc.student_id and sc.course_id = 3")]),t._v(" "),n("li",[t._v("right (outer) join列出右侧表的所有行记录（左侧表不匹配的行被筛选出的列值以null返回）\nselect * from t_student s right join t_student_coursr sc on s.id = sc.student_id and s.id = 3")]),t._v(" "),n("li",[t._v("full  (outer) join列出两个表的所有行记录（不管左侧表还是右侧表不匹配的行返回的列值以null返回）\nselect * from t_student s full join t_student_coursr sc on s.id = sc.student_id and s.id = 3 and sc.course_id = 3")])])]),t._v(" "),n("li",[t._v("内连接（inner）join 返回2个表都满足匹配条件的行记录\nselect * from t_student s join t_student_coursr  sc on s.id  = sc.student_id")])])])]),t._v(" "),n("h4",{attrs:{id:"综合查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#综合查询"}},[t._v("#")]),t._v(" 综合查询")]),t._v(" "),n("p",[t._v("不带all的，结果行会去重")]),t._v(" "),n("ul",[n("li",[t._v("union/union all 查询结果做并集\nselect * from t_student s1\nunion all\nselect * from t_student s2")]),t._v(" "),n("li",[t._v("intersect/intersect all 查询结果做交集\nselect * from t_student s1\nintersect\nselect * from t_student s2")]),t._v(" "),n("li",[t._v("except/except all 查询结果做差集，s1 - s2\nselect * from t_student s1 where id = 1\nexcept\nselect * from t_student s2 where id = 2")])]),t._v(" "),n("h4",{attrs:{id:"关于null-not-null"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于null-not-null"}},[t._v("#")]),t._v(" 关于NULL，NOT NULL")]),t._v(" "),n("p",[t._v("NULL值不是空的意思，理解为不确定的值。打个比方，女生不告诉你年龄，不代表年龄是0，我们表示这种不确定就用NULL。")]),t._v(" "),n("ul",[n("li",[t._v("NOT NULL在建表时用在列上表示列NOT NULL约束，表示在插入数据时，该列必须提供值"),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" t_student"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tch_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\thobby "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tstudent_no "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tsex "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("如上ch_name定义为not null，表示插入数据时ch_name必须提供值")]),t._v(" "),n("li",[t._v("如上hobby定义为null，这不意味着必须是null值，表示可以为null，如果不提供值，默认为null，另外这不是sql标准定义的。")]),t._v(" "),n("li",[t._v("对于表中重要字段，我们一般要定义为not null，对于可为null的字段，我们一般不需要显式定义为null，上面仅是一个示例。")]),t._v(" "),n("li",[t._v("在pg中显式使用not null约束要比使用check约束高效。")])])]),t._v(" "),n("li",[t._v("关于NULL的查询，条件使用is null，is not null，千万不能用=null\nselect * from t_student ts where hobby  is null\nselect * from t_student ts where hobby  is not null")])]),t._v(" "),n("h4",{attrs:{id:"分区使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分区使用"}},[t._v("#")]),t._v(" 分区使用")]),t._v(" "),n("p",[t._v("-- 分区测试\nCREATE TABLE customers (id INTEGER, status TEXT, arr NUMERIC) PARTITION BY LIST(status);\n-- 定义分区表名，及分区条件")]),t._v(" "),n("p",[t._v("-- List 分区\nCREATE TABLE cust_active PARTITION OF customers FOR VALUES IN ('ACTIVE');\nCREATE TABLE cust_archived PARTITION OF customers FOR VALUES IN ('EXPIRED');\nCREATE TABLE cust_others PARTITION OF customers DEFAULT;")]),t._v(" "),n("p",[t._v("\\d+ customers\n\\d+ cust_active")]),t._v(" "),n("p",[t._v("select * from cust_active\nselect * from cust_archived\nselect * from cust_others\nselect * from customers\nINSERT INTO customers VALUES (1,'ACTIVE',100), (2,'RECURRING',20), (3,'EXPIRED',38), (4,'REACTIVATED',144);")]),t._v(" "),n("p",[t._v("SELECT tableoid::regclass,* FROM customers;")]),t._v(" "),n("p",[t._v("-- 解绑分区\nALTER TABLE customers DETACH PARTITION cust_active;")]),t._v(" "),n("p",[t._v("-- 绑定分区\nALTER TABLE customers ATTACH PARTITION cust_active FOR VALUES IN ('ACTIVE');")]),t._v(" "),n("p",[t._v("select * from cust_active")]),t._v(" "),n("p",[t._v("-- RANGE 分区\nCREATE TABLE cust_arr_small PARTITION OF customers FOR VALUES FROM (MINVALUE) TO (25);")]),t._v(" "),n("p",[t._v("CREATE TABLE customers_new ( like customers including all ) PARTITION BY RANGE(arr);\nCREATE TABLE cust_arr_small PARTITION OF customers_new FOR VALUES FROM (MINVALUE) TO (25);\nCREATE TABLE cust_arr_medium PARTITION OF customers_new FOR VALUES FROM (25) TO (75);\nCREATE TABLE cust_arr_large PARTITION OF customers_new FOR VALUES FROM (75) TO (MAXVALUE);\ninsert into customers_new\nselect * from customers")]),t._v(" "),n("p",[t._v("alter table customers rename to customers_old\nalter table customers_new rename to customers")]),t._v(" "),n("p",[t._v("select * from customers\nselect * from cust_arr_small\nselect * from cust_arr_medium\nselect * from cust_arr_large")])])}),[],!1,null,null,null);s.default=e.exports}}]);